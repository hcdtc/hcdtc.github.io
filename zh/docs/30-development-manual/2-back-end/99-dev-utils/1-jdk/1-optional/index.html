<!DOCTYPE html>
<html>
    <head>
  <meta name="baidu-site-verification" content="NQB7kASlT6" />
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <title>Optional类</title>
  
  
  <meta name="keywords" content="devops">	
  

  

  
  <link rel="stylesheet" href="/font/iconfont.css">
  
  <script src="/js/rem.js"></script>
  
  <link href="/css/bootstrap.min.css" rel="stylesheet">

  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon-144.png">
  
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8b9485b9f982efd2c649f426a25b1fe8";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    
</head>

    <link href="/css/docs.css" rel="stylesheet">
    <header id="header">
        <div class='navbar  top-white-nav  top-nav' role="navigation" id="navbar">
    
        <div class="navbar-left-buttons">
            <button type="button" class="navbar-toggle btn-template-main">
                <i class="iconfont">&#xe78e;</i>
            </button>
        </div>
    
    
    

    <div class="navbar-buttons">
        <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation-mobile">
            <i class="iconfont">&#xe790;</i>
        </button>
    </div>

    <div class="navbar-collapse collapse" id="navigation">
        <ul class="nav navbar-nav navbar-right">
            
                
                    <li>
                        <a   href="/zh/docs/">文档</a>
                    </li>
                
            
                
                    <li>
                        <a   target="_blank"  href="https://github.com/hcdtc/hcdtc.github.io.git">GITHUB</a>
                    </li>
                
            
                
                    <li>
                        <a   href="/">返回首页</a>
                    </li>
                
            
            
        </ul>
    </div>
    <div class="global-language">
        <a>ZH</a>
        <ul class="language-list">
            
            <li><a href="/en/">English</a></li>
            
            <li><a href="/zh/">中文</a></li>
            
        </ul>
    </div>



</div>


<div class="navbar-collapse-bg none" id="navbar-collapse-bg">
    <div class="navbar-collapse collapse" id="navigation-mobile">
        
            
        
            
        
            
        
        <ul class="nav navbar-nav navbar-right">
            
                
                    <li>
                        <a   href="/zh/docs/">文档</a>
                    </li>
                
            
                
                    <li>
                        <a   target="_blank"  href="https://github.com/hcdtc/hcdtc.github.io.git">GITHUB</a>
                    </li>
                
            
                
                    <li>
                        <a   href="/">返回首页</a>
                    </li>
                
            
        </ul>
        
    </div>

</div>


    </header>
    <body>
        <div id="content" class="docs">
            
            
            <div class="docs-menu">
            <div class="docs-search"><div class="sidebar-menu search">
    <input id="search-input" class="search-input" type="text" placeholder='请搜索关键字'>
    <button id="search" class="search-button" type="submit">搜索</button>
</div></div>
                
                <li data-nav-id="/zh/docs/" class="dd-item parent haschildren">
                    <ul class="none">
                
                <li data-nav-id="/zh/docs/10-overview/" class="dd-item haschildren">
                        <div style='padding-left: 0.32rem;'>
                            <a href="/zh/docs/10-overview/">总体介绍</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                <li data-nav-id="/zh/docs/10-overview/0-team-overview/" class="dd-item">
                    <div style='padding-left: 0.48rem;'>
                    <a href="/zh/docs/10-overview/0-team-overview/">
                        团队介绍
                    </a>
                    </div>
                </li>
                    </ul>
                </li>
                
                <li data-nav-id="/zh/docs/20-development-specification/" class="dd-item haschildren">
                        <div style='padding-left: 0.32rem;'>
                            <a href="/zh/docs/20-development-specification/">开发规范</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                
                <li data-nav-id="/zh/docs/20-development-specification/1-basic/" class="dd-item haschildren">
                        <div style='padding-left: 0.48rem;'>
                            <a href="/zh/docs/20-development-specification/1-basic/">基础开发规范</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                
                <li data-nav-id="/zh/docs/20-development-specification/1-basic/1-branch-management/" class="dd-item">
                        <div style='padding-left: 0.64rem;'>
                            <a href="/zh/docs/20-development-specification/1-basic/1-branch-management/">分支管理</a>
                        
                        </div>
                </li>
                
                <li data-nav-id="/zh/docs/20-development-specification/1-basic/2-version-management/" class="dd-item">
                        <div style='padding-left: 0.64rem;'>
                            <a href="/zh/docs/20-development-specification/1-basic/2-version-management/">版本管理</a>
                        
                        </div>
                </li>
                
                <li data-nav-id="/zh/docs/20-development-specification/1-basic/3-name-convention/" class="dd-item">
                        <div style='padding-left: 0.64rem;'>
                            <a href="/zh/docs/20-development-specification/1-basic/3-name-convention/">命名规范</a>
                        
                        </div>
                </li>
                    </ul>
                </li>
                
                <li data-nav-id="/zh/docs/20-development-specification/2-front-end/" class="dd-item haschildren">
                        <div style='padding-left: 0.48rem;'>
                            <a href="/zh/docs/20-development-specification/2-front-end/">前端开发规范</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                
                <li data-nav-id="/zh/docs/20-development-specification/2-front-end/1-develop-env/" class="dd-item haschildren">
                        <div style='padding-left: 0.64rem;'>
                            <a href="/zh/docs/20-development-specification/2-front-end/1-develop-env/">开发环境搭建</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                <li data-nav-id="/zh/docs/20-development-specification/2-front-end/1-develop-env/index_mac/" class="dd-item">
                    <div style='padding-left: 0.8rem;'>
                    <a href="/zh/docs/20-development-specification/2-front-end/1-develop-env/index_mac/">
                        开发环境搭建(Mac)
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/20-development-specification/2-front-end/1-develop-env/index_windows/" class="dd-item">
                    <div style='padding-left: 0.8rem;'>
                    <a href="/zh/docs/20-development-specification/2-front-end/1-develop-env/index_windows/">
                        开发环境搭建(Windows)
                    </a>
                    </div>
                </li>
                    </ul>
                </li>
                
                <li data-nav-id="/zh/docs/20-development-specification/2-front-end/2-code-standard/" class="dd-item haschildren">
                        <div style='padding-left: 0.64rem;'>
                            <a href="/zh/docs/20-development-specification/2-front-end/2-code-standard/">编码规范</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                <li data-nav-id="/zh/docs/20-development-specification/2-front-end/2-code-standard/index_ued/" class="dd-item">
                    <div style='padding-left: 0.8rem;'>
                    <a href="/zh/docs/20-development-specification/2-front-end/2-code-standard/index_ued/">
                        UED开发编码规范
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/20-development-specification/2-front-end/2-code-standard/index_constants/" class="dd-item">
                    <div style='padding-left: 0.8rem;'>
                    <a href="/zh/docs/20-development-specification/2-front-end/2-code-standard/index_constants/">
                        页面布局常量
                    </a>
                    </div>
                </li>
                    </ul>
                </li>
                    </ul>
                </li>
                
                <li data-nav-id="/zh/docs/20-development-specification/3-back-end/" class="dd-item">
                        <div style='padding-left: 0.48rem;'>
                            <a href="/zh/docs/20-development-specification/3-back-end/">后端开发规范</a>
                        
                        </div>
                </li>
                    </ul>
                </li>
                
                <li data-nav-id="/zh/docs/30-development-manual/" class="dd-item parent haschildren">
                        <div style='padding-left: 0.32rem;'>
                            <a href="/zh/docs/30-development-manual/">开发手册</a>
                        
                            <i class="iconfont caret-down icon-arrow-up"></i>
                        </div>
                    <ul class="none">
                
                <li data-nav-id="/zh/docs/30-development-manual/1-front-end/" class="dd-item haschildren">
                        <div style='padding-left: 0.48rem;'>
                            <a href="/zh/docs/30-development-manual/1-front-end/">前端开发手册</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                
                <li data-nav-id="/zh/docs/30-development-manual/1-front-end/1-technology-stack/" class="dd-item">
                        <div style='padding-left: 0.64rem;'>
                            <a href="/zh/docs/30-development-manual/1-front-end/1-technology-stack/">开发技术栈</a>
                        
                        </div>
                </li>
                    </ul>
                </li>
                
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/" class="dd-item parent haschildren">
                        <div style='padding-left: 0.48rem;'>
                            <a href="/zh/docs/30-development-manual/2-back-end/">后端开发手册</a>
                        
                            <i class="iconfont caret-down icon-arrow-up"></i>
                        </div>
                    <ul class="none">
                
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/98-dev-architect/" class="dd-item haschildren">
                        <div style='padding-left: 0.64rem;'>
                            <a href="/zh/docs/30-development-manual/2-back-end/98-dev-architect/">开发框架解析</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/98-dev-architect/1-spring/" class="dd-item haschildren">
                        <div style='padding-left: 0.8rem;'>
                            <a href="/zh/docs/30-development-manual/2-back-end/98-dev-architect/1-spring/">Spring系列</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/98-dev-architect/1-spring/1-spring-boot-overview/" class="dd-item">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/98-dev-architect/1-spring/1-spring-boot-overview/">
                        Spring Boot简介
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/98-dev-architect/1-spring/2-spring-boot-autoconfigure/" class="dd-item">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/98-dev-architect/1-spring/2-spring-boot-autoconfigure/">
                        Spring Boot自动化配置
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/98-dev-architect/1-spring/3-spring-boot-config/" class="dd-item">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/98-dev-architect/1-spring/3-spring-boot-config/">
                        Spring Boot配置类
                    </a>
                    </div>
                </li>
                    </ul>
                </li>
                
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/98-dev-architect/2-mybatis/" class="dd-item">
                        <div style='padding-left: 0.8rem;'>
                            <a href="/zh/docs/30-development-manual/2-back-end/98-dev-architect/2-mybatis/">MyBatis系列</a>
                        
                        </div>
                </li>
                    </ul>
                </li>
                
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/" class="dd-item parent haschildren">
                        <div style='padding-left: 0.64rem;'>
                            <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/">开发工具类</a>
                        
                            <i class="iconfont caret-down icon-arrow-up"></i>
                        </div>
                    <ul class="none">
                
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/1-jdk/" class="dd-item parent haschildren">
                        <div style='padding-left: 0.8rem;'>
                            <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/1-jdk/">JDK工具类</a>
                        
                            <i class="iconfont caret-down icon-arrow-up"></i>
                        </div>
                    <ul class="none">
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/1-jdk/1-optional/" class="dd-item active">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/1-jdk/1-optional/">
                        Optional类
                    </a>
                    </div>
                </li>
                    </ul>
                </li>
                
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/" class="dd-item haschildren">
                        <div style='padding-left: 0.8rem;'>
                            <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/">common-lang3</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/1-stringutils/" class="dd-item">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/1-stringutils/">
                        StringUtils工具类
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/2-arrayutils/" class="dd-item">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/2-arrayutils/">
                        ArrayUtils工具类
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/3-dateutils/" class="dd-item">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/3-dateutils/">
                        DateUtils工具类
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/4-dateformatutils/" class="dd-item">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/4-dateformatutils/">
                        DateFormatUtils工具类
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/5-classutils/" class="dd-item">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/5-classutils/">
                        ClassUtils工具类
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/6-methodutils/" class="dd-item">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/6-methodutils/">
                        MethodUtils工具类
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/7-fieldutils/" class="dd-item">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/7-fieldutils/">
                        FieldUtils工具类
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/8-objectutils/" class="dd-item">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/8-objectutils/">
                        ObjectUtils工具类
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/9-booleanutils/" class="dd-item">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/9-booleanutils/">
                        BooleanUtils工具类
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/10-randomutils/" class="dd-item">
                    <div style='padding-left: 0.96rem;'>
                    <a href="/zh/docs/30-development-manual/2-back-end/99-dev-utils/2-common-lang3/10-randomutils/">
                        RandomUtils工具类
                    </a>
                    </div>
                </li>
                    </ul>
                </li>
                    </ul>
                </li>
                    </ul>
                </li>
                
                <li data-nav-id="/zh/docs/30-development-manual/3-dev-tools/" class="dd-item haschildren">
                        <div style='padding-left: 0.48rem;'>
                            <a href="/zh/docs/30-development-manual/3-dev-tools/">开发工具指引</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                <li data-nav-id="/zh/docs/30-development-manual/3-dev-tools/1-git/" class="dd-item">
                    <div style='padding-left: 0.64rem;'>
                    <a href="/zh/docs/30-development-manual/3-dev-tools/1-git/">
                        Git使用指南
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/30-development-manual/3-dev-tools/2-idea/" class="dd-item">
                    <div style='padding-left: 0.64rem;'>
                    <a href="/zh/docs/30-development-manual/3-dev-tools/2-idea/">
                        Idea使用指南
                    </a>
                    </div>
                </li>
                    </ul>
                </li>
                    </ul>
                </li>
                
                <li data-nav-id="/zh/docs/80-team-doc/" class="dd-item haschildren">
                        <div style='padding-left: 0.32rem;'>
                            <a href="/zh/docs/80-team-doc/">团队文档</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                
                <li data-nav-id="/zh/docs/80-team-doc/1-doc-quickstart/" class="dd-item haschildren">
                        <div style='padding-left: 0.48rem;'>
                            <a href="/zh/docs/80-team-doc/1-doc-quickstart/">文档指南</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                <li data-nav-id="/zh/docs/80-team-doc/1-doc-quickstart/1-contribute-quickstart/" class="dd-item">
                    <div style='padding-left: 0.64rem;'>
                    <a href="/zh/docs/80-team-doc/1-doc-quickstart/1-contribute-quickstart/">
                        文档贡献指南
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/80-team-doc/1-doc-quickstart/2-hugo-quickstart/" class="dd-item">
                    <div style='padding-left: 0.64rem;'>
                    <a href="/zh/docs/80-team-doc/1-doc-quickstart/2-hugo-quickstart/">
                        Hugo框架指引
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/80-team-doc/1-doc-quickstart/3-markdown-quickstart/" class="dd-item">
                    <div style='padding-left: 0.64rem;'>
                    <a href="/zh/docs/80-team-doc/1-doc-quickstart/3-markdown-quickstart/">
                        MarkDown速查手册
                    </a>
                    </div>
                </li>
                    </ul>
                </li>
                    </ul>
                </li>
                
                <li data-nav-id="/zh/docs/99-code-review/" class="dd-item haschildren">
                        <div style='padding-left: 0.32rem;'>
                            <a href="/zh/docs/99-code-review/">代码复查</a>
                        <i class="iconfont caret-right icon-arrow-down"></i>
                        </div>
                    <ul class="none">
                <li data-nav-id="/zh/docs/99-code-review/1-check-list/" class="dd-item">
                    <div style='padding-left: 0.48rem;'>
                    <a href="/zh/docs/99-code-review/1-check-list/">
                        代码复查清单
                    </a>
                    </div>
                </li>
                <li data-nav-id="/zh/docs/99-code-review/99-review-log/" class="dd-item">
                    <div style='padding-left: 0.48rem;'>
                    <a href="/zh/docs/99-code-review/99-review-log/">
                        代码复查日志
                    </a>
                    </div>
                </li>
                    </ul>
                </li>
                    </ul>
                </li>
            
            
            </div>
            
            <div class='docs-post content-post ' id="content-post" >
                

<h1 id="使用-java8-optional-的正确姿势">使用 Java8 Optional 的正确姿势</h1>

<p>原文链接：<a href="http://www.importnew.com/22060.html">使用 Java8 Optional 的正确姿势</a></p>

<p>我们知道 Java 8 增加了一些很有用的 API, 其中一个就是 Optional. 如果对它不稍假探索, 只是轻描淡写的认为它可以优雅的解决 NullPointException 的问题, 于是代码就开始这么写了</p>

<pre><code class="language-java">Optional&lt;User&gt; user = ……
if (user.isPresent()) {
    return user.getOrders();
} else {
    return Collections.emptyList();
}
</code></pre>

<p>那么不得不说我们的思维仍然是在原地踏步, 只是本能的认为它不过是 User 实例的包装, 这与我们之前写成</p>

<pre><code class="language-java">User user = …..
if (user != null) {
    return user.getOrders();
} else {
    return Collections.emptyList();
}
</code></pre>

<p>实质上是没有任何分别. 这就是我们将要讲到的使用好 Java 8 Optional 类型的正确姿势。我们切换到 Java 8 的 Optional 时, 不能继承性的对待过往 null 时的那种思维, 应该掌握好新的, 正确的使用 Java 8 Optional 的正确姿势.</p>

<p>直白的讲, 当我们还在以如下几种方式使用 Optional 时, 就得开始检视自己了</p>

<ul>
<li>调用 isPresent() 方法时<br /></li>
<li>调用 get() 方法时<br /></li>
<li>Optional 类型作为类/实例属性时<br /></li>
<li>Optional 类型作为方法参数时</li>
</ul>

<p>Optional 中我们真正可依赖的应该是除了 isPresent() 和 get() 的其他方法:</p>

<ul>
<li><code>public&lt;U&gt; Optional&lt;U&gt; map(Function&lt;? super T, ? extends U&gt; mapper)</code></li>
<li><code>public T orElse(T other)</code></li>
<li><code>public T orElseGet(Supplier&lt;? extends T&gt; other)</code></li>
<li><code>public void ifPresent(Consumer&lt;? super T&gt; consumer)</code></li>
<li><code>public Optional&lt;T&gt; filter(Predicate&lt;? super T&gt; predicate)</code></li>
<li><code>public&lt;U&gt; Optional&lt;U&gt; flatMap(Function&lt;? super T, Optional&lt;U&gt;&gt; mapper)</code></li>
<li><code>public &lt;X extends Throwable&gt; T orElseThrow(Supplier&lt;? extends X&gt; exceptionSupplier) throws X</code></li>
</ul>

<p>不提一下 Optional 的三种构造方式: <code>Optional.of(obj)</code>,  <code>Optional.ofNullable(obj)</code> 和明确的 <code>Optional.empty()</code></p>

<p><code>Optional.of(obj)</code>: 它要求传入的 obj 不能是 null 值的, 否则还没开始进入角色就倒在了 NullPointerException 异常上了.</p>

<p><code>Optional.ofNullable(obj)</code>: 它以一种智能的, 宽容的方式来构造一个 Optional 实例. 来者不拒, 传 null 进到就得到 Optional.empty(), 非 null 就调用 Optional.of(obj).</p>

<p>那是不是我们只要用 Optional.ofNullable(obj) 一劳永逸, 以不变应二变的方式来构造 Optional 实例就行了呢? 那也未必, 否则 Optional.of(obj) 何必如此暴露呢, 私有则可?</p>

<ol>
<li>当我们非常非常的明确将要传给 Optional.of(obj) 的 obj 参数不可能为 null 时, 比如它是一个刚 new 出来的对象(Optional.of(new User(&hellip;))), 或者是一个非 null 常量时;<br /></li>
<li>当想为 obj 断言不为 null 时, 即我们想在万一 obj 为 null 立即报告 NullPointException 异常, 立即修改, 而不是隐藏空指针异常时, 我们就应该果断的用 Optional.of(obj) 来构造 Optional 实例, 而不让任何不可预计的 null 值有可乘之机隐身于 Optional 中.</li>
</ol>

<p>现在才开始怎么去使用一个已有的 Optional 实例, 假定我们有一个实例 Optional<User> user, 下面是几个普遍的, 应避免 if(user.isPresent()) { &hellip; } else { &hellip; } 几中应用方式.</p>

<h4 id="存在即返回-无则提供默认值">存在即返回, 无则提供默认值</h4>

<pre><code class="language-java">return user.orElse(null);  //而不是 return user.isPresent() ? user.get() : null;
return user.orElse(UNKNOWN_USER);
</code></pre>

<h4 id="存在即返回-无则由函数来产生">存在即返回, 无则由函数来产生</h4>

<pre><code class="language-java">return user.orElseGet(() -&gt; fetchAUserFromDatabase()); //而不要 return user.isPresent() ? user: fetchAUserFromDatabase();
</code></pre>

<h4 id="存在才对它做点什么">存在才对它做点什么</h4>

<pre><code class="language-java">user.ifPresent(System.out::println);
 
//而不要下边那样
if (user.isPresent()) {
  System.out.println(user.get());
}
</code></pre>

<h4 id="map-函数隆重登场">map 函数隆重登场</h4>

<p>当 user.isPresent() 为真, 获得它关联的 orders, 为假则返回一个空集合时, 我们用上面的 orElse, orElseGet 方法都乏力时, 那原本就是 map 函数的责任, 我们可以这样一行</p>

<pre><code class="language-java">return user.map(u -&gt; u.getOrders()).orElse(Collections.emptyList())
 
//上面避免了我们类似 Java 8 之前的做法
if(user.isPresent()) {
  return user.get().getOrders();
} else {
  return Collections.emptyList();
}
</code></pre>

<p>map  是可能无限级联的, 比如再深一层, 获得用户名的大写形式</p>

<pre><code class="language-java">return user.map(u -&gt; u.getUsername())
           .map(name -&gt; name.toUpperCase())
           .orElse(null);
</code></pre>

<p>这要搁在以前, 每一级调用的展开都需要放一个 null 值的判断</p>

<pre><code class="language-java">User user = .....
if(user != null) {
  String name = user.getUsername();
  if(name != null) {
    return name.toUpperCase();
  } else {
    return null;
  }
} else {
  return null;
}
</code></pre>

<p>用了 isPresent() 处理 NullPointerException 不叫优雅, 有了  orElse, orElseGet 等, 特别是 map 方法才叫优雅.</p>

<p>其他几个, filter() 把不符合条件的值变为 empty(),  flatMap() 总是与 map() 方法成对的,  orElseThrow() 在有值时直接返回, 无值时抛出想要的异常.</p>

<p>一句话小结: 使用 Optional 时尽量不直接调用 Optional.get() 方法, Optional.isPresent() 更应该被视为一个私有方法, 应依赖于其他像 Optional.orElse(), Optional.orElseGet(), Optional.map() 等这样的方法.</p>

<p>最后, 最好的理解 Java 8 Optional 的方法莫过于看它的源代码 java.util.Optional, 阅读了源代码才能真真正正的让你解释起来最有底气, Optional 的方法中基本都是内部调用  isPresent() 判断, 真时处理值, 假时什么也不做.</p>

            </div>
            <div class="article-menu">
                
                <ul id="article-nav-ul">
                </ul>
            </div>
        </div>
        
        
        <div style="clear: both;"></div>

        <footer id="footer" class="footer">
    <nav class="footer-nav">
        
            
                <a href="/zh/docs/">文档</a>
            
        
            
                
        
            
                <a href="/">返回首页</a>
            
        
    </nav>
    <div class="social">
        <a href="https://github.com/choerodon/" target="_blank" class="social-single"><i class="iconfont icon-github-footer"></i></a>
        <i class="iconfont icon-wechat-footer social-single"></i>
        <div class="wechat-hover load-img">
            <div data-loader='circle'></div>
            <img data-src="/img/footer/wechat-code.jpg"/>
        </div>
        
        <a href="http://forum.choerodon.io/" target="_blank" class="social-single"><i class="iconfont icon-forum-footer"></i></a>
    </div>
    <div class="copy-right" class="center">
        Copyright &copy; The Choerodon Author. All rights reserved.
    </div>
    <div id="big-img" class="black-big-img">
        <img src="" alt="">
    </div>
</footer>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
        
        <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        
        
        
    </body>

    <script src="/js/front.js"></script>

    <script src="/js/doc-search.js"></script>

    <script src="/js/docs.js"></script>

    <script src="/js/player.js"></script>

</html>
